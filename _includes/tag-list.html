<div id="tags">
  {% if site.tag_archive.path %}
    {% capture _site_tags %}{% for tag in site.tags %}{{ tag | first }}{% unless forloop.last %}---{% endunless %}{% endfor %}{% endcapture %}

    {% assign tags_sorted = _site_tags | split:'---' | sort %}

    <div class="tag-list">
      <h2>Tags</h2>
      {% for tag_word in tags_sorted %}
        <a href="{{ tag_word | slugify | prepend: '#' | prepend: site.tag_archive.path | prepend: site.baseurl }}" class="" rel="tag">
          #{{ tag_word }}
        </a>
      {% endfor %}
    </div>

    <hr>

    <div>
      {% for tag_word in tags_sorted %}
        {% assign posts = site.tags[tag_word] %}

        <h2 id="{{ tag_word }}">#{{ tag_word }}</h2>

        {% for post in posts %}
          {% if post.tags contains tag_word %}
            <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
            <span class="date">{{ post.date | date: "%B %-d, %Y"  }}</span>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  {% endif %}
</div>